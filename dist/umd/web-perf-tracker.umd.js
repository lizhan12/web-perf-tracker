!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).webPerfTracker={})}(this,(function(e){"use strict";var t,n,r,i,o,a,s,u;!function(e){e.PAGE_VIEW="PageView",e.EVENT="EVENT",e.PERF="Perf",e.RESOURCE="Resource",e.ACTION="Action",e.FETCH="Fetch",e.CODE_ERROR="CodeError",e.CONSOLE="Console",e.CUSTOMER="Customer"}(t||(t={})),function(e){e.MOBILE="mobile",e.PC="pc",e.WEBVIEW="webview",e.MINI_PROGRAM="miniProgram"}(n||(n={})),function(e){e.error="error",e.warn="warn",e.info="info",e.debug="debug"}(r||(r={})),function(e){e.ANDROID_H5="android",e.IOS_H5="ios",e.PC_H5="pc",e.BROWSER_H5="browser"}(i||(i={})),function(e){e.UNKNOWN="UNKNOWN",e.JAVASCRIPT="JAVASCRIPT",e.LOG="LOG",e.HTTP="HTTP",e.VUE="VUE",e.REACT="REACT",e.RESOURCE="RESOURCE",e.PROMISE="PROMISE",e.ROUTE="ROUTE",e.PERF="PERF"}(o||(o={})),function(e){e.Else="else",e.Error="error",e.Warning="warning",e.Info="info",e.Debug="debug",e.Low="low",e.Normal="normal",e.High="high",e.Critical="critical"}(a||(a={})),function(e){e.Http="http",e.User="user",e.Debug="debug",e.Exception="exception",e.Lifecycle="lifecycle"}(s||(s={})),function(e){e.ROUTE="Route",e.CLICK="UI.Click",e.CONSOLE="Console",e.FETCH="Fetch",e.UNHANDLEDREJECTION="Unhandledrejection",e.RESOURCE="Resource",e.CODE_ERROR="Code Error",e.CUSTOMER="Customer"}(u||(u={}));var c,l,d,f,m,p=-1,h=function(e){addEventListener("pageshow",(function(t){t.persisted&&(p=t.timeStamp,e(t))}),!0)},v=function(){var e=self.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0];if(e&&e.responseStart>0&&e.responseStart<performance.now())return e},g=function(){var e=v();return e&&e.activationStart||0},E=function(e,t){var n=v(),r="navigate";return p>=0?r="back-forward-cache":n&&(document.prerendering||g()>0?r="prerender":document.wasDiscarded?r="restore":n.type&&(r=n.type.replace(/_/g,"-"))),{name:e,value:void 0===t?-1:t,rating:"good",delta:0,entries:[],id:"v4-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:r}},y=function(e,t,n){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){var r=new PerformanceObserver((function(e){Promise.resolve().then((function(){t(e.getEntries())}))}));return r.observe(Object.assign({type:e,buffered:!0},n||{})),r}}catch(e){}},T=function(e,t,n,r){var i,o;return function(a){t.value>=0&&(a||r)&&((o=t.value-(i||0))||void 0===i)&&(i=t.value,t.delta=o,t.rating=function(e,t){return e>t[1]?"poor":e>t[0]?"needs-improvement":"good"}(t.value,n),e(t))}},b=function(e){requestAnimationFrame((function(){return requestAnimationFrame((function(){return e()}))}))},R=function(e){document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&e()}))},C=function(e){var t=!1;return function(){t||(e(),t=!0)}},w=-1,O=function(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0},I=function(e){"hidden"===document.visibilityState&&w>-1&&(w="visibilitychange"===e.type?e.timeStamp:0,S())},L=function(){addEventListener("visibilitychange",I,!0),addEventListener("prerenderingchange",I,!0)},S=function(){removeEventListener("visibilitychange",I,!0),removeEventListener("prerenderingchange",I,!0)},x=function(){return w<0&&(w=O(),L(),h((function(){setTimeout((function(){w=O(),L()}),0)}))),{get firstHiddenTime(){return w}}},A=function(e){document.prerendering?addEventListener("prerenderingchange",(function(){return e()}),!0):e()},P=[1800,3e3],M=function(e,t){t=t||{},A((function(){var n,r=x(),i=E("FCP"),o=y("paint",(function(e){e.forEach((function(e){"first-contentful-paint"===e.name&&(o.disconnect(),e.startTime<r.firstHiddenTime&&(i.value=Math.max(e.startTime-g(),0),i.entries.push(e),n(!0)))}))}));o&&(n=T(e,i,P,t.reportAllChanges),h((function(r){i=E("FCP"),n=T(e,i,P,t.reportAllChanges),b((function(){i.value=performance.now()-r.timeStamp,n(!0)}))})))}))},D=[.1,.25],F=0,H=1/0,U=0,N=function(e){e.forEach((function(e){e.interactionId&&(H=Math.min(H,e.interactionId),U=Math.max(U,e.interactionId),F=U?(U-H)/7+1:0)}))},k=function(){return c?F:performance.interactionCount||0},B=function(){"interactionCount"in performance||c||(c=y("event",N,{type:"event",buffered:!0,durationThreshold:0}))},W=[],$=new Map,V=0,_=[],q=function(e){if(_.forEach((function(t){return t(e)})),e.interactionId||"first-input"===e.entryType){var t=W[W.length-1],n=$.get(e.interactionId);if(n||W.length<10||e.duration>t.latency){if(n)e.duration>n.latency?(n.entries=[e],n.latency=e.duration):e.duration===n.latency&&e.startTime===n.entries[0].startTime&&n.entries.push(e);else{var r={id:e.interactionId,latency:e.duration,entries:[e]};$.set(r.id,r),W.push(r)}W.sort((function(e,t){return t.latency-e.latency})),W.length>10&&W.splice(10).forEach((function(e){return $.delete(e.id)}))}}},G=function(e){var t=self.requestIdleCallback||self.setTimeout,n=-1;return e=C(e),"hidden"===document.visibilityState?e():(n=t(e),R(e)),n},J=[200,500],j=function(e,t){"PerformanceEventTiming"in self&&"interactionId"in PerformanceEventTiming.prototype&&(t=t||{},A((function(){var n;B();var r,i=E("INP"),o=function(e){G((function(){e.forEach(q);var t=function(){var e=Math.min(W.length-1,Math.floor((k()-V)/50));return W[e]}();t&&t.latency!==i.value&&(i.value=t.latency,i.entries=t.entries,r())}))},a=y("event",o,{durationThreshold:null!==(n=t.durationThreshold)&&void 0!==n?n:40});r=T(e,i,J,t.reportAllChanges),a&&(a.observe({type:"first-input",buffered:!0}),R((function(){o(a.takeRecords()),r(!0)})),h((function(){V=k(),W.length=0,$.clear(),i=E("INP"),r=T(e,i,J,t.reportAllChanges)})))})))},K=[2500,4e3],X={},z=[800,1800],Y=function e(t){document.prerendering?A((function(){return e(t)})):"complete"!==document.readyState?addEventListener("load",(function(){return e(t)}),!0):setTimeout(t,0)},Q=function(e,t){t=t||{};var n=E("TTFB"),r=T(e,n,z,t.reportAllChanges);Y((function(){var i=v();i&&(n.value=Math.max(i.responseStart-g(),0),n.entries=[i],r(!0),h((function(){n=E("TTFB",0),(r=T(e,n,z,t.reportAllChanges))(!0)})))}))},Z={passive:!0,capture:!0},ee=new Date,te=function(e,t){l||(l=t,d=e,f=new Date,ie(removeEventListener),ne())},ne=function(){if(d>=0&&d<f-ee){var e={entryType:"first-input",name:l.type,target:l.target,cancelable:l.cancelable,startTime:l.timeStamp,processingStart:l.timeStamp+d};m.forEach((function(t){t(e)})),m=[]}},re=function(e){if(e.cancelable){var t=(e.timeStamp>1e12?new Date:performance.now())-e.timeStamp;"pointerdown"==e.type?function(e,t){var n=function(){te(e,t),i()},r=function(){i()},i=function(){removeEventListener("pointerup",n,Z),removeEventListener("pointercancel",r,Z)};addEventListener("pointerup",n,Z),addEventListener("pointercancel",r,Z)}(t,e):te(t,e)}},ie=function(e){["mousedown","keydown","touchstart","pointerdown"].forEach((function(t){return e(t,re,Z)}))},oe=[100,300];const ae=e=>{!function(e,t){t=t||{},A((function(){var n,r=x(),i=E("LCP"),o=function(e){t.reportAllChanges||(e=e.slice(-1)),e.forEach((function(e){e.startTime<r.firstHiddenTime&&(i.value=Math.max(e.startTime-g(),0),i.entries=[e],n())}))},a=y("largest-contentful-paint",o);if(a){n=T(e,i,K,t.reportAllChanges);var s=C((function(){X[i.id]||(o(a.takeRecords()),a.disconnect(),X[i.id]=!0,n(!0))}));["keydown","click"].forEach((function(e){addEventListener(e,(function(){return G(s)}),!0)})),R(s),h((function(r){i=E("LCP"),n=T(e,i,K,t.reportAllChanges),b((function(){i.value=performance.now()-r.timeStamp,X[i.id]=!0,n(!0)}))}))}}))}(e),function(e,t){t=t||{},A((function(){var n,r=x(),i=E("FID"),o=function(e){e.startTime<r.firstHiddenTime&&(i.value=e.processingStart-e.startTime,i.entries.push(e),n(!0))},a=function(e){e.forEach(o)},s=y("first-input",a);n=T(e,i,oe,t.reportAllChanges),s&&(R(C((function(){a(s.takeRecords()),s.disconnect()}))),h((function(){var r;i=E("FID"),n=T(e,i,oe,t.reportAllChanges),m=[],d=-1,l=null,ie(addEventListener),r=o,m.push(r),ne()})))}))}(e),function(e,t){t=t||{},M(C((function(){var n,r=E("CLS",0),i=0,o=[],a=function(e){e.forEach((function(e){if(!e.hadRecentInput){var t=o[0],n=o[o.length-1];i&&e.startTime-n.startTime<1e3&&e.startTime-t.startTime<5e3?(i+=e.value,o.push(e)):(i=e.value,o=[e])}})),i>r.value&&(r.value=i,r.entries=o,n())},s=y("layout-shift",a);s&&(n=T(e,r,D,t.reportAllChanges),R((function(){a(s.takeRecords()),n(!0)})),h((function(){i=0,r=E("CLS",0),n=T(e,r,D,t.reportAllChanges),b((function(){return n()}))})),setTimeout(n,0))})))}(e),Q(e),j(e),M(e)};function se(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const{fetch:ue}=window,ce=({onError:e,onBefore:t,onAfter:n})=>(function(){const r=XMLHttpRequest.prototype.open,i=XMLHttpRequest.prototype.send;let o=0;XMLHttpRequest.prototype.open=function(e,n,i,o,a){return this._method=e,t&&t({url:n,name:"axios-before",method:e}),r.apply(this,arguments)},XMLHttpRequest.prototype.send=function(t){o=Re();const r=this.onreadystatechange;return this.onreadystatechange=function(){this.readyState===XMLHttpRequest.DONE&&(this.status>=200&&this.status<300?n&&n({status:this.status,url:this.responseURL,name:"axios-after",statusText:this.statusText,elapsedTime:Re()-o}):e&&e({message:this.statusText,status:this.status,url:this.responseURL,name:"axios-err",method:this._method,body:t,elapsedTime:Re()-o,options:void 0,statusText:this.statusText,stack:""})),r&&r.apply(this,arguments)},i.apply(this,arguments)}}(),(...r)=>se(void 0,void 0,void 0,(function*(){const[i,o]=r,a=Re(),s="string"==typeof i?{url:i,method:((null==o?void 0:o.method)||"GET").toLocaleUpperCase()}:i;let u;try{t&&t({url:i.url,method:null==i?void 0:i.method,name:"fetch-before",options:o}),u=yield ue(i,o),n&&n({url:u.url,method:s.method,status:u.status,name:"fetch-after",elapsedTime:Re()-a})}catch(e){}return u&&u.ok&&u.status>=200&&u.status<300||e({url:s.url,name:"fetch-err",status:null==u?void 0:u.status,statusText:(null==u?void 0:u.statusText)||"",method:null==s?void 0:s.method,body:null==o?void 0:o.body,elapsedTime:Re()-a,options:void 0,message:"",stack:""}),u})));var le=function(e=new Date){let t=e.getMonth()+1+"",n=e.getFullYear()+"",r=e.getDate()+"",i=e.getMinutes()+"",o=e.getHours()+"";return t=de(t),r=de(r),o=de(o),i=de(i),{year:n,month:t,day:r,hour:o,min:i}};const de=function(e){return Number(e)>9?e:"0"+e},fe=function(e,t){switch(e){case"-":return pe(t);case"/":return he(t);case"zh":return ve(t);default:return me(t)}},me=function(e){return e.year+""+e.month+e.day+e.hour+e.min+"00"},pe=function(e){return e.year+"-"+e.month+"-"+e.day+" "+e.hour+":"+e.min},he=function(e){return e.year+"/"+e.month+"/"+e.day+" "+e.hour+":"+e.min},ve=function(e,t=!1){let n=e.year+"年"+e.month+"月"+e.day+"日"+e.hour+"时";return Number(e.min)>0||t?n+(e.min+"分"):n},ge=function(e){return{year:e.slice(0,4),month:e.slice(4,6),day:e.slice(6,8),hour:e.slice(8,10),min:e.slice(10,12)}},Ee=function(e){return"string"==typeof e&&(e=new Date(e)),le(e)};class ye{static getInstance(){return this.instance}constructor(){}formatDate(e,t="",n=!1){return n&&(e=new Date(e.valueOf())).setMinutes(0),fe(t,le(e))}formatToFormat(e,t=""){let n=t.toLowerCase();if("string"!=typeof e)throw"replace must be string";switch(e=(e=e.replace(/分/gi,"")).replace(/时/gi,":"),n){case"/":return e.replace(/[-,年,月,/]/gi,"/").replace(/日/gi," ");case"-":return e.replace(/[-,年,月,/]/gi,"-").replace(/日/gi," ");case"zh":return e=e.replace(/[-,年,月,/," " , :]/gi,"").replace(/日/gi,""),fe(n,ge(e));default:return e.replace(/[-,年,月,/," " , :]/gi,"").replace(/日/gi,"")}}formatNoSpaceDate(e,t="/"){return fe(t,ge(e))}isSameMin(e,t){const n=Ee(e),r=Ee(t);return n.year==r.year&&n.month==r.month&&n.day==r.day&&n.hour==r.hour&&n.min==r.min}isSameHour(e,t){const n=Ee(e),r=Ee(t);return n.year==r.year&&n.month==r.month&&n.day==r.day&&n.hour==r.hour}isSameDate(e,t){const n=Ee(e),r=Ee(t);return n.year==r.year&&n.month==r.month&&n.day==r.day}isSameMonth(e,t){const n=Ee(e),r=Ee(t);return n.year==r.year&&n.month==r.month}isSameYear(e,t){const n=Ee(e),r=Ee(t);return n.year==r.year}diff(e,t,n=!0){const r=(e.getTime()-t.getTime())/6e4;return n?Math.floor(Math.abs(r)):Math.floor(r)}fiveFloorMinDate(e,t=5,n=!1){n&&(e=new Date(e.valueOf()));let r=e.getMinutes();return r=Math.floor(r/t)*t,e.setMinutes(r),e.setSeconds(0),e.setMilliseconds(0),e}floorHourDate(e,t=!1){return t&&(e=new Date(e.valueOf())),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e}worldFormat(e,t=""){const n=new Date(e.valueOf());return n.setHours(n.getHours()-8),this.formatDate(n,t)}}ye.instance=new ye;var Te=ye.getInstance();class be{onGlobalClick(){const e=this;window.addEventListener("click",(t=>{const n=t.target.innerHTML,r={name:"click",level:a.Normal,type:u.CLICK,category:s.User,message:n,time:Re()};e.saveBreadcrumb(r)}))}saveBreadcrumb(e){this.breadcrumb.push(e),this.breadcrumb.length>this.maxBreadcrumb&&this.breadcrumb.shift()}sendImmediate(e,t){const n={dataId:Ce(t+a.Error+e),level:a.Error,name:e,message:"",time:Re(),type:t,stack:null},r=this.setTraceData(n);Ie(this.options.url,r)}constructor(e={url:"",openClick:!1,openFech:!0,openResource:!0,appId:"",sendTimer:3e4,filterUrlList:[]}){var t,r,i;this.perfData={id:Le()},this.resources=[],this.observer=null,this.breadcrumb=[],this.maxBreadcrumb=5,this.queue=[],this.sendTimer=3e4,this.userAgent=navigator.userAgent,this.browserType=(r=navigator.userAgent,(i={}).isMobile=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(r.toLowerCase()),i.isPC=!i.isMobile,i.isWebView=(t=!1,(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(r)||/Android.*(wv|\.0\.0\.0)/.test(r))&&(t=!0),t),i.isMiniProgram=!0,i.isMobile?n.MOBILE:i.isPC?n.PC:i.isWebView?n.WEBVIEW:n.MINI_PROGRAM),this.appId="",this.filterUrlList=[],this.options=e,this.isOpenFetchBefore=e.isOpenFetchBefore,this.isOpenFetchAfter=e.isOpenFetchAfter,this.appId=e.appId||"",this.fpId=(e=>{if(!e)return console.error("content is empty"),"";const t=document.createElement("canvas"),n=t.getContext("2d");if(!n)return"";const r=e||"geekbang";n.textBaseline="top",n.font="14px 'Arial'",n.fillStyle="#f60",n.fillRect(125,1,60,20),n.fillStyle="#069",n.fillText(r,2,15);const i=t.toDataURL().replace("data:image/png;base64,",""),o=function(e){let t="";for(let n=0;n<e.length;n++)t+=("0"+e.charCodeAt(n).toString(16)).slice(-2);return t}(atob(i).slice(-25,-12));return o})(this.appId),this.filterUrlList=e.filterUrlList||[],this.pageId=Ce(document.URL)+"",this.sendTimer=e.sendTimer||3e4,this.options.openResource&&(this.observer=new PerformanceObserver((e=>{e.getEntries().forEach((e=>{"resource"===e.entryType&&this.handleObserverResource(e)}))})))}setTraceData(e){let n=t.CONSOLE,s=r.debug,u=null,c=null;e.dataId&&(n=function(e){if(e==o.HTTP)return t.FETCH;if(e==o.JAVASCRIPT)return t.CODE_ERROR;if(e==o.RESOURCE)return t.RESOURCE;if(e==o.PERF)return t.PERF;return t.ACTION}(e.type),s=function(e){if(e==a.Error)return r.error;if(e==a.Warning)return r.warn;if(e==a.Info)return r.info;if(e==a.Debug)return r.debug;return r.info}(e.level),u=e),e.id&&(n=t.PERF,s=function(e){if((e.FCP||0)>2e3)return r.error;if((e.FCP||0)>1500)return r.warn;if((e.FCP||0)>1e3)return r.info;return r.info}(e),c=e);return{type:n,level:s,createdAt:Te.formatDate(new Date,"/"),updatedAt:Te.formatDate(new Date,"/"),data:u,perf:c,breadcrumbs:this.breadcrumb,traceId:Le(),ua:this.userAgent,bt:this.browserType,fpId:this.fpId,appId:this.appId,clientType:i.BROWSER_H5,url:document.URL,pid:Ce(document.URL)+""}}send(e){const t=this.setTraceData(e);Ie(this.options.url,t)}log(e){this.saveBreadcrumb({name:"customer-log",level:e.level,type:Oe(e.type),category:(e.type,s.Exception),message:e.message,time:Re()})}static init(e){var t;const n=new be(e);return n.onGlobalError(),ae(n.createPerfReport()),n.options.openResource&&(null===(t=n.observer)||void 0===t||t.observe({entryTypes:["resource"],buffered:!0})),n.options.openClick&&n.onGlobalClick(),window.traceSdk=n,n.options.openFech&&function(e){window.fetch=ce({onError:t=>{var n,r;const i=(null===(n=t.url)||void 0===n?void 0:n.split("?")[0])||"",c=null===(r=null==i?void 0:i.split("//")[1])||void 0===r?void 0:r.split("/")[0];e.filterUrlList.includes(c)||(e.saveBreadcrumb({name:t.name||"",level:a.Error,type:u.FETCH,category:s.Http,message:t.status,time:Re(),response:{method:t.method,url:t.url,status:t.status,statusText:t.statusText,elapsedTime:t.elapsedTime}}),e.sendImmediate(t.name||"",o.HTTP))},onBefore:t=>{var n,r;const i=(null===(n=t.url)||void 0===n?void 0:n.split("?")[0])||"",o=null===(r=null==i?void 0:i.split("//")[1])||void 0===r?void 0:r.split("/")[0];e.isOpenFetchBefore&&!e.filterUrlList.includes(o)&&e.saveBreadcrumb({name:t.name||"",level:a.Normal,type:u.FETCH,category:s.Http,message:"",time:Re(),request:{method:t.method,url:t.url}})},onAfter:t=>{var n,r;const i=(null===(n=t.url)||void 0===n?void 0:n.split("?")[0])||"",o=null===(r=null==i?void 0:i.split("//")[1])||void 0===r?void 0:r.split("/")[0];e.isOpenFetchAfter&&!e.filterUrlList.includes(o)&&e.saveBreadcrumb({name:t.name||"",level:a.Normal,type:u.FETCH,category:s.Http,message:"",time:Re(),response:{method:t.method,url:t.url,status:t.status,elapsedTime:t.elapsedTime,statusText:t.statusText}})}})}(n),setInterval((()=>{const e=n.queue.shift();Object.keys(n.perfData).length>8&&(n.send(n.perfData),n.perfData={}),e&&n.send(e)}),n.sendTimer),null===window||void 0===window||window.addEventListener("beforeunload",(()=>{let e=n.queue.shift(),t=0;for(;e&&t<10;)n.send(e),e=n.queue.shift(),t++})),n}info(e,t){this.log({name:"customer-log",type:o.LOG,level:a.Info,message:e,time:Re(),dataId:Ce(`${e}|${t||""}`),tag:t||""})}warn(e,t){this.log({name:"customer-log",type:o.LOG,level:a.Warning,message:e,time:Re(),dataId:Ce(`${e}|${t||""}`),tag:t||""})}error(e,t){this.log({name:"customer-error",type:o.LOG,level:a.Error,message:e,time:Re(),dataId:Ce(`${e}|${t||""}`),tag:t||""})}onGlobalError(){window.addEventListener("error",(e=>{this.saveError(e)}),!0)}createPerfReport(){return e=>{this.perfData=Object.assign(Object.assign({},this.perfData),function(e){const t=-1!==["FCP","TTFB","LCP","CLS","FID"].indexOf(e.name);return{[e.name]:t?(n=e.value,e.name,Math.round(100*n)/100):e.value,[`${e.name}Rating`]:e.rating};var n}(e))}}handleObserverResource(e){let t=a.Info;if(e.duration>1e3&&e.duration<1500?t=a.Warning:e.duration>1500&&(t=a.Error),e.duration>1e3){const n={url:e.name,name:`${e.entryType}-duration-${e.initiatorType}`,type:o.PERF,level:t,message:`duration:${Math.round(e.duration)}`,time:Re(),dataId:Ce(`${e.entryType}-${e.name}`)};this.resources.push(n)}}saveError(e){var t,n,r;const i=e.target,c=we(i),l=i.nodeName;if(c){const t=i.getAttribute("src")||i.getAttribute("href");if(t){const n={dataId:Ce(`${l}${e.message}${t}`),name:"resource-load-error",level:a.Warning,message:e.message,time:Re(),type:o.RESOURCE,stack:[t]};this.breadcrumb.push({name:n.name,type:u.RESOURCE,category:s.Exception,level:a.Warning,message:e.message,time:Re(),request:{url:t}}),this.sendImmediate((null===(r=e.error)||void 0===r?void 0:r.name)||"",o.RESOURCE)}}else Ce("script-error"+a.Error),a.Error,e.message,Re(),o.JAVASCRIPT,null===(t=e.error)||void 0===t?void 0:t.stack,this.breadcrumb.push({name:e.error.name,type:u.CODE_ERROR,category:s.Exception,level:a.Error,message:e.message,stack:e.error.stack,time:Re()}),this.sendImmediate((null===(n=e.error)||void 0===n?void 0:n.name)||"",o.JAVASCRIPT)}}function Re(){return Date.now()}function Ce(e){let t=0;for(let n=0;n<e.length;n++){t=31*t+e.charCodeAt(n)|0}return Math.abs(t)}const we=e=>e instanceof HTMLScriptElement||e instanceof HTMLLinkElement||e instanceof HTMLImageElement||e instanceof HTMLVideoElement||e instanceof HTMLAudioElement;function Oe(e){return o.LOG==e?u.CLICK:o.PERF==e?u.CODE_ERROR:o.RESOURCE==e?u.RESOURCE:o.JAVASCRIPT==e?u.CODE_ERROR:u.CLICK}function Ie(e,t){const n=-1===e.indexOf("?")?"?":"&",r=`${e}${n}data=${encodeURIComponent(function(e){const t=new Set,n=JSON.stringify(e,(function(e,n){return t.has(n)?null:("object"==typeof n&&t.add(n),n)}));return t.clear(),n}(t))}`;let i=new Image;i.src=r,i.onload=function(){i=null},i.onerror=function(e){i=null}}function Le(){var e=(new Date).getTime();return"undefined"!=typeof performance&&"function"==typeof performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))}e.BaseTrace=be,e.getTimestamp=Re,e.isResourceTarget=we}));
